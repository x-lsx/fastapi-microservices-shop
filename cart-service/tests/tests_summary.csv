"Класс/метод","Почему тестируем"
"CartService.get_cart","Создаёт корзину при отсутствии (вызов repo.create_cart) и возвращает существующую корзину в противном случае"
"CartService.add_item","Валидация продукта и размера через ProductClient.validate_product_and_size; при новом товаре вызывает repo.add_item; при существующем — увеличивает количество и вызывает repo.update_item; возвращает обновлённую корзину"
"CartService.remove_item","Если элемент отсутствует — возвращает HTTP 404; при наличии — вызывает repo.remove_item и возвращает обновлённую корзину"
"CartService.change_item_quantity","Покрывает ветвления: delta==0 (без изменений), отсутствует + delta>0 (добавление), отсутствует + delta<0 (404), существующий элемент → new_qty<=0 (удаление), delta>0 (валидация и обновление)"
"CartService.clear_cart","Удаляет все позиции корзины через repo.remove_item и возвращает корзину"
